<!DOCTYPE html>
<html lang="de">

    <head>
        <meta charset="UTF-8">
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        >
        <title>Shop Status</title>
        <script
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
            defer
        ></script>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>

    <body>
        <div id="counter">
            <div
                x-data="shopStatus()"
                x-init="init()"
                class="
                "
            >
                <!-- <p>Current Date and Time: <span x-text="currentDateTime"></span></p> -->
                <p><span
                        x-text="open? 'Geöffnet' : 'Geschlossen'"
                        :class="{ 'text-green-500': status === 'Open', 'text-red-500': status === 'Closed' }"
                    ></span></p>
                <div class="text-green-500">
                    <p x-show="status === 'Open'">Bis wir schließen: <span
                            class="font-bold underline underline-offset-2"
                            x-text="timeUntilClosing"
                        ></span></p>
                    <p x-show="status === 'Closed'">Wir öffnen in: <span x-text="timeUntilOpening"></span></p>
                </div>
            </div>
            <script>
                function shopStatus() {
                    return {
                        currentDateTime: '',
                        status: '',
                        timeUntilClosing: '',
                        timeUntilOpening: '',

                        init() {
                            this.updateStatus();
                            setInterval(() => this.updateStatus(), 1000);
                        },

                        updateStatus() {
                            const now = new Date();
                            this.currentDateTime = now.toLocaleString();

                            const day = now.getDay();
                            const hour = now.getHours();
                            const minutes = now.getMinutes();
                            const seconds = now.getSeconds();

                            if (day === 0) {
                                this.status = 'Closed';
                                this.calculateTimeUntilOpening(1, 7, 0, 0);
                            } else if (hour >= 7 && hour < 20) {
                                this.status = 'Open';
                                this.calculateTimeUntilClosing(hour, minutes, seconds);
                            } else {
                                this.status = 'Closed';
                                this.calculateTimeUntilOpening(day, hour, minutes, seconds);
                            }
                        },

                        calculateTimeUntilClosing(hour, minutes, seconds) {
                            const closingTime = new Date();
                            closingTime.setHours(20, 0, 0, 0);
                            const timeDiff = closingTime - new Date();
                            this.timeUntilClosing = this.formatTimeDiff(timeDiff);
                        },

                        calculateTimeUntilOpening(day, hour, minutes, seconds) {
                            const openingTime = new Date();
                            if (day === 6 && hour >= 20) {
                                openingTime.setDate(openingTime.getDate() + 2);
                            } else if (hour >= 20) {
                                openingTime.setDate(openingTime.getDate() + 1);
                            } else if (hour < 7) {
                                openingTime.setDate(openingTime.getDate());
                            }
                            openingTime.setHours(7, 0, 0, 0);
                            const timeDiff = openingTime - new Date();
                            this.timeUntilOpening = this.formatTimeDiff(timeDiff);
                        },

                        formatTimeDiff(timeDiff) {
                            const hours = Math.floor(timeDiff / 3600000);
                            const minutes = Math.floor((timeDiff % 3600000) / 60000);
                            const seconds = Math.floor((timeDiff % 60000) / 1000);
                            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        }
                    }
                }
            </script>
        </div>

    </body>

</html>